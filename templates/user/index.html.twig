<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acceuil</title>
    <link rel="stylesheet" href="{{ asset('assets/w3.css')}}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="{{ asset('assets/bootstrap/bootstrap.min.css') }}" rel="stylesheet">
    <script src="{{ asset('assets/bootstrap/bootstrap.bundle.min.js') }}"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    
    <style>
        * {
            box-sizing: border-box;
        }

        body, h1, h2, h3, h4, h5, h6 {
            font-family: "Times New Roman", Times, serif;
        }

        button {
            width: 100%;
        }

        .container {
            min-height: 350px;
            background: #fff;
            border-radius: 2px;
            overflow: hidden;
            box-shadow: 0 14px 28px rgba(0, 0, 0, 0.15);
            margin-bottom: 5%;
        }

        /* Refonte du menu de navigation pour mieux utiliser W3.CSS */
        #nav {
            width: 20%;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 999;
            padding-top: 20px;
        }

        #nav a {
            display: block;
            margin: 10px 0;
        }

        /* Mobile Responsiveness */
        @media(max-width: 1050px) {
            #nav {
                width: 100%;
                position: relative;
                height: auto;
            }
        }

        .content-wrapper {
            margin-left: 22%;
            padding: 20px;
        }

        /* Refonte des boutons */
        .w3-button {
            margin-bottom: 10px;
        }

    </style>
</head>
<body>

    {# Vérifiez si l'utilisateur a le rôle ADMIN #}
    {% if is_granted('ROLE_ADMIN') %}
        <div class="w3-row">
            <div class="w3-col w3-amber" id="nav">
                <h1 class="w3-opacity h5 mb-3 font-weight-normal"><i class="fa fa-user-circle w3-opacity"></i> {{ app.user.userIdentifier }}</h1>
                <a href="{{ path('user_index') }}"><button class="w3-button w3-text-black w3-opacity"><i class="fa fa-user"></i>   Utilisateur</button></a>
                <a href="{{ path('ordreRoute_index') }}"><button class="w3-button w3-text-black w3-opacity">Ordre de route</button></a>
                <a href="{{ path('bst_index') }}"><button class="w3-button w3-text-black w3-opacity">Bon Spécial de Transport</button></a>
                <a href="{{ path('bse_index') }}"><button class="w3-button w3-text-black w3-opacity">Mission</button></a>
                <a href="{{ path('payment_index') }}"><button class="w3-button w3-text-black w3-opacity"><i class="fas fa-dollar-sign"></i> Payement</button></a>
                <a href="{{ path('pdf_bst') }}"><button class="w3-button w3-text-black w3-opacity">PDF BST</button></a>
                <a href="{{ path('pdf_or') }}"><button class="w3-button w3-text-black w3-opacity">PDF OR</button></a>
                <a href="{{ path('bureau_index') }}"><button class="w3-button w3-text-black w3-opacity"><i class="fas fa-building"></i> Agence</button></a>
                <a href="{{ path('credit_index') }}"><button class="w3-button w3-text-black w3-opacity"><i class="fas fa-sync"></i> Renouveler crédit</button></a>
                <a href="{{ path('app_logout') }}"><button class="w3-button w3-text-black w3-opacity"><i class="fas fa-sign-out-alt"></i> Se déconnecter</button></a>
                <a href="{{ path('send_email') }}"><button class="w3-button w3-text-black w3-opacity">Envoyer email</button></a>
            </div>
    {% elseif is_granted('ROLE_MISSIONNAIRE') %}
        <div class="w3-container content-wrapper">
            <h1>Missionnaire</h1>
            <p>Liste des missionnaires</p>
            <a href=""><button class="w3-button">Générer mon OR</button></a>
            <a href=""><button class="w3-button">Générer mon BST</button></a>
            <a href="{{ path('app_logout') }}"><button class="w3-button">Se déconnecter</button></a>
        </div>
    {% elseif is_granted('ROLE_USER') %}
        <div class="w3-container content-wrapper">
            <h1>Utilisateur pour Payement et création</h1>
            <a href="{{ path('bst_index') }}"><button class="w3-button">Bon Spécial de Transport</button></a>
            <a href="{{ path('bse_index') }}"><button class="w3-button">Bon de saisie des engagements</button></a>
            <a href="{{ path('ordreRoute_index') }}"><button class="w3-button">Ordre de route</button></a>
            <a href="{{ path('payment_index') }}"><button class="w3-button">Payement</button></a>
            <a href=""><button class="w3-button">Deduire facture du bst</button></a>
            <a href=""><button class="w3-button">Générer rapport</button></a>
            <a href=""><button class="w3-button">Générer un OR</button></a>
            <a href=""><button class="w3-button">Générer un BST</button></a>
            <a href="{{ path('app_logout') }}"><button class="w3-button">Se déconnecter</button></a>
        </div>
    {% endif %}

    <!-- Recherche Utilisateur -->
    <div class="w3-container content-wrapper">
        <input type="text" id="searchInput" class="w3-input w3-border" placeholder="Tapez pour rechercher...">
        <div id="searchResults" class="mt-3"></div>
    </div>

    <!-- Liste des utilisateurs -->
    <div class="w3-container content-wrapper">
        <a href="{{ path('app_register') }}" class="w3-button w3-blue"><i class="fa fa-user-plus"></i> Créer un nouvel utilisateur</a>
        <div>
            {% for user in user %}
                <div class="w3-container w3-animate-zoom w3-half w3-margin-bottom">
                    <div class="container w3-card-4 w3-margin">
                        <div class="w3-display-container w3-section">
                            <h5 class="w3-display-topmiddle w3-red"><i class="fa fa-user w3-opacity"></i><b> {{ user.titre }} {{ user.nom }}</b></h5>
                        </div>
                        <div class="w3-padding">
                            <a href="{{ path('user_show', {id: user.id}) }}" class="w3-button w3-light-grey w3-small">Voir</a>
                            <a href="{{ path('user_edit', {id: user.id}) }}" class="w3-button w3-yellow w3-small">Modifier</a>
                            <a href="{{ path('user_delete', {id: user.id}) }}" class="w3-button w3-red w3-small">Supprimer</a>
                            <p>Matricule: {{ user.matricule }}</p>
                            <p>Nom: {{ user.nom }}</p>
                            <p>Prenom: {{ user.prenom }}</p>
                            <p>Sexe: {{ user.sexe }}</p>
                            <p>Fonction: {{ user.fonction }}</p>
                            <p>Situation Familiale: {{ user.situationFamiliale }}</p>
                            <p>CIN: {{ user.cin }}</p>
                            <p>Date CIN: {{ user.dateCin|date('Y-m-d') }}</p>
                            <p>Taux journalier: {{ user.tauxJournalier }}</p>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>

    <script>
        document.getElementById('searchInput').addEventListener('input', function(event) {
            let searchTerm = event.target.value;

            if (searchTerm.length >= 0) {
                fetch(`/user/ajax?q=${searchTerm}`)
                    .then(response => response.json())
                    .then(data => {
                        let resultsDiv = document.getElementById('searchResults');
                        resultsDiv.innerHTML = '';

                        if (data.length === 0) {
                            resultsDiv.innerHTML = '<p>Aucun résultat trouvé.</p>';
                        } else {
                            data.forEach(employe => {
                                let row = document.createElement('div');
                                row.classList.add('w3-card', 'w3-margin', 'w3-padding');
                                row.innerHTML = `
                                    <div><strong>${employe.nom} ${employe.prenom}</strong><br>Email: ${employe.email}</div>
                                    <button class="w3-button w3-blue">Voir</button>
                                `;
                                resultsDiv.appendChild(row);
                            });
                        }
                    })
                    .catch(error => {
                        console.error('Erreur lors de la recherche:', error);
                        document.getElementById('searchResults').innerHTML = '<p>Une erreur est survenue lors de la recherche.</p>';
                    });
            } else {
                document.getElementById('searchResults').innerHTML = '';
            }
        });
    </script>

</body>
</html>
