<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Acceuil</title>
    <link rel="stylesheet" href="{{ asset('assets/w3.css')}}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="{{ asset('assets/bootstrap/bootstrap.min.css') }}" rel="stylesheet">
    <script src="{{ asset('assets/bootstrap/bootstrap.bundle.min.js') }}"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    
    <style>
        *{
            box-sizing: border-box;
        }
        a{
            text-decoration: none;
            color: grey;
        }
        body, h1, h2, h3, h4, h5, h6 {
            font-family: "Times New Roman", Times, serif;
        }
        button{
            width: 100%;
        }
        #nav{
            width:20%;
            height: 100vh;
        }
        body, h1, h2, h3, h4, h5, h6 {
            font-family: "Times New Roman", Times, serif;
        }
        .container{
            min-height: 350px;
            background:#fff;
            border-radius: 2px;
            overflow: hidden;
            box-shadow: 0 14px 28px rgba(0,0,0,0.15);
            margin-bottom: 5%;
        }
        p{
        }
        @media(max-width:1050px){
            #nav{
                width: 100%;
            }
        }
    </style>
</head>
<body>

    {# Vérifiez si l'utilisateur a le rôle ADMIN #}
    {% if is_granted('ROLE_ADMIN') %}
        <div class="w3-row">
            <div class="w3-col w3-amber " id="nav">
                <!--img src="{{ asset('images/logo.png') }}" class="w3-bar-item w3-circle w3-hide-small" style="width:85px"-->
                <h1 class="w3-opacity h5 mb-3 font-weight-normal"><i class="fa fa-user-circle w3-opacity"></i>  {{ app.user.userIdentifier }}</h1>
                <a href="{{path('app_register')}}"><button class="w3-button w3-text-black w3-opacity"><i class="fa fa-user-plus w3-opacity"></i> Nouveau utilisateur</button></a>
                <a href="{{path('ordreRoute_index')}}"><button class="w3-button w3-text-black w3-opacity">Ordre de route</button></a>
                <a href="{{path('bst_index')}}"><button class="w3-button w3-text-black w3-opacity">Bon Spécial de Transport</button></a>
                <a href="{{path('bse_index')}}"><button class="w3-button w3-text-black w3-opacity">Mission</button></a>
                <a href="{{path('payment_index')}}"><button class="w3-button w3-text-black w3-opacity"><i class="fas fa-dollar-sign"></i>Payement</button></a>
                <a href="{{path('pdf_bst')}}"><button class="w3-button w3-text-black w3-opacity">pdf</button></a>
                <a href="{{path('pdf_or')}}"><button class="w3-button w3-text-black w3-opacity">Or</button></a>
                <a href="{{path('user_index')}}"><button class="w3-button w3-text-black w3-opacity"><i class="fas fa-flag"></i>Missionnaire</button></a>
                <a href="{{path('bureau_index')}}"><button class="w3-button w3-text-black w3-opacity"><i class="fas fa-building"></i>Agence</button></a>
                <a href="{{path('credit_index')}}"><button class="w3-button w3-text-black w3-opacity"><i class="fas fa-sync"></i>Renouveller credit</button></a>
                <!--a href=""><button class="w3-button w3-text-black w3-opacity">Deduire facture du bst</button></a>
                <a href=""><button class="w3-button w3-text-black w3-opacity">Générer rapport</button></a-->
                <a href="{{ path('app_logout') }}"><button class="w3-button w3-text-black w3-opacity"><i class="fas fa-sign-out-alt"></i>Se deconnecter</button></a>
                <a href="{{ path('send_email') }}"><button class="w3-button w3-text-black w3-opacity">Send email</button></a>
            </div>

    {# Vérifiez si l'utilisateur a le rôle MISSIONNAIRE #}
    {% elseif is_granted('ROLE_MISSIONNAIRE') %}
        <div class="example-wrapper">
            <h1>Missionnaire</h1>
            <p>Liste des missionnaires</p>
            <a href=""><button>Générer mon OR</button></a>
            <a href=""><button>Générer mon BST</button></a>
    <a href="{{ path('app_logout') }}"><button>Se deconnecter</button></a>
        </div>


    {# Vérifiez si l'utilisateur a le rôle USER #}
    {% elseif is_granted('ROLE_USER') %}
        <div class="example-wrapper">
            <h1>Utilisateur pour Payement et création </h1>
            <a href="{{path('bst_index')}}"><button>Bon Spécial de Transport</button></a>
            <a href="{{path('bse_index')}}"><button>Bon de saisie des engagements</button></a>
            <a href="{{path('ordreRoute_index')}}"><button>Ordre de route</button></a>
            <a href="{{path('payment_index')}}"><button>Payement</button></a>
            <a href="{{path('payment_index')}}"><button>Deduire facture du bst</button></a>
            <a href=""><button>Générer rapport</button></a>
            <a href=""><button>Générer un OR</button></a>
            <a href=""><button>Générer un BST</button></a>
    <a href="{{ path('app_logout') }}"><button>Se deconnecter</button></a>
        </div>
    {% endif %}


  <div class="">

    <div class="">
        <label for="searchInput">Rechercher :</label>
        <input type="text" id="searchInput" class="" placeholder="Tapez pour rechercher...">
    </div>

    <div id="searchResults" class="mt-3"></div>
</div>


<div class="w3-col" style="width:80%">
    <a href="{{ path('user_new') }}">Create new user</a>
    <div>
        {% for user in user %}
            <div  class="w3-container w3-animate-zoom w3-half">
            <div class="container">
            <div class="w3-display-container w3-section w3-margin">
                <h5 class="w3-display-topmiddle w3-red"><i class="fa fa-user w3-opacity"></i><b>   {{ user.titre}} {{ user.nom }}</b></h5>
            </div>
            <div class="">
                <a href="{{ path('user_show', {id: user.id}) }}">{{ user.nom }}</a>
                <p>Matricule: {{ user.matricule }}</p>
                <p>Nom: {{ user.nom }}</p>
                <p>Prenom: {{ user.prenom }}</p>
                <p>Sexe: {{ user.sexe }}</p>
                <p>Fonction: {{ user.fonction }}</p>
                <p>Situation Familiale:{{ user.situationFamiliale }}</p>
                <p>CIN: {{ user.cin }}</p>
                <p>Date CIN: {{ user.dateCin|date('Y-m-d') }}</p>
                <p>Taux journalier: {{ user.tauxJournalier }}</p>
                <p>Titre: </p>
                <a href="{{ path('user_edit', {id: user.id}) }}">Edit</a>
                <a href="{{ path('user_delete', {id: user.id}) }}">Delete</a>
            </div>
            </div>
            </div>
        {% endfor %}
    </div>

</div>















<script>
    document.getElementById('searchInput').addEventListener('input', function(event) {
        let searchTerm = event.target.value;

        // Effectuer la recherche uniquement si le terme a 3 caractères ou plus
        if (searchTerm.length >= 0) {
            fetch(`/user/ajax?q=${searchTerm}`)
                .then(response => response.json())
                .then(data => {
                    let resultsDiv = document.getElementById('searchResults');
                    resultsDiv.innerHTML = '';  // Vider les anciens résultats

                    if (data.length === 0) {
                        resultsDiv.innerHTML = '<p>Aucun résultat trouvé.</p>';
                    } else {
                        // Affichage des résultats
                        data.forEach(employe => {
                            let row = document.createElement('div');
                            row.classList.add('result-row', 'border', 'p-2', 'mb-2');
                            row.innerHTML = `
                                <div>
                                    <strong>${employe.nom} ${employe.prenom}</strong><br>
                                    Email: ${employe.email}<br>
                                    <button class="btn btn-primary createButton" data-id="${employe.id}">Créer</button>
                                </div>
                            `;
                            resultsDiv.appendChild(row);
                        });

                        // Ajout de l'événement au bouton "Créer"
                        let createButtons = document.querySelectorAll('.createButton');
                        createButtons.forEach(button => {
                            button.addEventListener('click', function() {
                                let employeId = button.getAttribute('data-id');
                                console.log('Créer l\'employé avec l\'ID:', employeId);
                                alert('Processus de création de l\'employé avec l\'ID : ' + employeId);
                            });
                        });
                    }
                })
                .catch(error => {
                    console.error('Erreur lors de la recherche:', error);
                    document.getElementById('searchResults').innerHTML = '<p>Une erreur est survenue lors de la recherche.</p>';
                });
        } else {
            document.getElementById('searchResults').innerHTML = '';  // Vider les résultats si la recherche est inférieure à 3 caractères
        }
    });
</script>
